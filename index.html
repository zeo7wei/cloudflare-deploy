<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å¦†å¹¿å‘Šåˆè§„ AI åŠ©ç†</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', 'PingFang SC', sans-serif;
            background: #ffffff;
            color: #1a1a1a;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 40px;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 40px;
            border-bottom: 1px solid #e5e5e5;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 100;
        }
        
        .logo {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* å¤©å¹³Logo */
        .logo-icon {
            width: 32px;
            height: 32px;
            position: relative;
            flex-shrink: 0;
        }
        
        /* å¤©å¹³ä¸­æŸ± */
        .logo-icon::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 28px;
            background: #1a3a6b;
            left: 50%;
            top: 2px;
            transform: translateX(-50%);
        }
        
        /* å¤©å¹³æ¨ªæ¢ */
        .logo-icon::after {
            content: '';
            position: absolute;
            width: 28px;
            height: 2px;
            background: #1a3a6b;
            left: 50%;
            top: 8px;
            transform: translateX(-50%);
        }
        
        /* å·¦æ‰˜ç›˜ */
        .scale-left {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #1a3a6b;
            border-radius: 50%;
            left: 2px;
            top: 20px;
        }
        
        .scale-left::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 8px solid #1a3a6b;
            top: -10px;
            left: -1px;
        }
        
        /* å³æ‰˜ç›˜ */
        .scale-right {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #1a3a6b;
            border-radius: 50%;
            right: 2px;
            top: 20px;
        }
        
        .scale-right::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 8px solid #1a3a6b;
            top: -10px;
            left: -1px;
        }
        
        .nav-menu {
            display: flex;
            gap: 40px;
            align-items: center;
        }
        
        .nav-link {
            font-size: 14px;
            color: #1a1a1a;
            text-decoration: none;
            font-weight: 400;
            transition: color 0.2s;
        }
        
        .nav-link:hover {
            color: #ff6b35;
        }
        
        /* Hero åŒºåŸŸ */
        .hero {
            padding: 80px 0;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .hero-title {
            font-size: 56px;
            font-weight: 400;
            line-height: 1.2;
            margin-bottom: 24px;
            max-width: 700px;
        }
        
        .hero-subtitle {
            font-size: 18px;
            color: #666;
            line-height: 1.8;
            max-width: 600px;
        }
        
        /* å¯¼èˆªæ ‡ç­¾ */
        .tabs {
            display: flex;
            gap: 0;
            margin: 60px 0 40px;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .tab {
            padding: 16px 32px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: -1px;
        }
        
        .tab:hover {
            color: #1a1a1a;
        }
        
        .tab.active {
            color: #1a1a1a;
            border-bottom-color: #1a1a1a;
        }
        
        /* ç½‘æ ¼å¸ƒå±€ */
        .grid {
            display: grid;
            gap: 24px;
            margin-bottom: 60px;
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        
        /* å¡ç‰‡ */
        .card {
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 40px;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        .card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
            transform: translateY(-4px);
        }
        
        .card-icon {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1a1a1a;
        }
        
        .card-text {
            font-size: 14px;
            color: #666;
            line-height: 1.7;
        }
        
        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 1px dashed #d0d0d0;
            border-radius: 8px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .upload-area:hover {
            border-color: #1a1a1a;
            background: #fafafa;
        }
        
        .upload-area input {
            display: none;
        }
        
        .upload-icon {
            font-size: 40px;
            margin-bottom: 16px;
            color: #666;
        }
        
        .upload-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #1a1a1a;
        }
        
        .upload-subtitle {
            font-size: 13px;
            color: #999;
        }
        
        /* æ–‡æœ¬è¾“å…¥ */
        .textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 24px;
            transition: border-color 0.2s;
        }
        
        .textarea:focus {
            outline: none;
            border-color: #1a1a1a;
        }
        
        /* æŒ‰é’® */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 32px;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: #1a1a1a;
        }
        
        .btn:hover {
            background: #1a1a1a;
            color: #fff;
        }
        
        .btn-primary {
            background: #1a1a1a;
            color: #fff;
            width: 100%;
        }
        
        .btn-primary:hover {
            background: #333;
        }
        
        .btn-primary:disabled {
            background: #e5e5e5;
            border-color: #e5e5e5;
            color: #999;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            border: 1px solid #e5e5e5;
            color: #666;
            font-size: 11px;
            padding: 8px 16px;
        }
        
        .btn-secondary:hover {
            border-color: #1a1a1a;
            color: #1a1a1a;
            background: transparent;
        }
        
        /* åˆ—è¡¨é¡¹ */
        .list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .list-item:hover {
            background: #f5f5f5;
            border-color: #d0d0d0;
        }
        
        .list-item-content {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }
        
        .list-item-icon {
            width: 36px;
            height: 36px;
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
        }
        
        .list-item-icon svg {
            width: 20px;
            height: 20px;
            color: #666;
        }
        
        .list-item-title {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 2px;
            color: #1a1a1a;
        }
        
        .list-item-meta {
            font-size: 10px;
            color: #999;
        }
        
        /* å›¾ç‰‡ç½‘æ ¼ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .image-item {
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .image-item:hover {
            border-color: #1a1a1a;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }
        
        .image-item.selected {
            border-color: #ff6b35;
            border-width: 2px;
        }
        
        .image-item img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }
        
        .image-name {
            padding: 12px;
            font-size: 13px;
            color: #666;
            background: #fafafa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin: 40px 0;
        }
        
        .stat {
            text-align: center;
            padding: 40px 24px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* é—®é¢˜å¡ç‰‡ */
        .issue {
            padding: 24px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }
        
        .issue:hover {
            border-color: #1a1a1a;
        }
        
        .issue.error {
            border-left: 3px solid #ff3b30;
        }
        
        .issue.warning {
            border-left: 3px solid #ff9500;
        }
        
        .issue-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .issue-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f5f5f5;
            color: #666;
        }
        
        .issue-word {
            font-size: 17px;
            font-weight: 600;
        }
        
        .issue-suggestion {
            font-size: 14px;
            line-height: 1.7;
            color: #666;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .alert {
            padding: 16px 20px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #666;
        }
        
        /* åˆ†åŒº */
        .section {
            margin-bottom: 60px;
        }
        
        .section-title {
            font-size: 32px;
            font-weight: 400;
            margin-bottom: 32px;
            color: #1a1a1a;
        }
        
        .section-subtitle {
            font-size: 14px;
            color: #999;
            margin-bottom: 24px;
        }
        
        /* æˆåŠŸçŠ¶æ€ */
        .success-state {
            text-align: center;
            padding: 80px 40px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        
        .success-icon {
            font-size: 64px;
            margin-bottom: 24px;
            color: #34c759;
        }
        
        .success-title {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 12px;
            color: #1a1a1a;
        }
        
        .success-text {
            font-size: 15px;
            color: #666;
        }
        
        /* åˆ†éš”çº¿ */
        .divider {
            height: 1px;
            background: #e5e5e5;
            margin: 60px 0;
        }
        
        /* å·¥å…·ç±» */
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-3 {
            gap: 24px;
        }
        
        .mb-4 {
            margin-bottom: 32px;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }
            
            .hero-title {
                font-size: 36px;
            }
            
            .grid-2,
            .grid-3,
            .grid-4,
            .stats,
            .image-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* åŠ¨ç”» */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const GEMINI_API_KEY = 'AIzaSyDO69s-TOgi_vG6w2EV57HIcZAqVKCGtfI';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent';
        

        // Vercel APIåœ°å€ï¼ˆéƒ¨ç½²åä¼šè‡ªåŠ¨ä½¿ç”¨æ­£ç¡®åœ°å€ï¼‰
        const PROXY_API_URL = '/api/qwen-ocr';

        const App = () => {
          const [activeTab, setActiveTab] = useState('scanner');
          const [textInput, setTextInput] = useState('');
          const [loading, setLoading] = useState(false);
          const [scanResults, setScanResults] = useState(null);
          
          const [uploadedImages, setUploadedImages] = useState([]);
          const [selectedImages, setSelectedImages] = useState([]);
          const [uploadedTextFiles, setUploadedTextFiles] = useState([]);
          const [isExtractingText, setIsExtractingText] = useState(false);
          
          // æ–‡ä»¶ä¸Šä¼ è¿›åº¦çŠ¶æ€
          const [uploadingFile, setUploadingFile] = useState(null);
          const [uploadProgress, setUploadProgress] = useState('');
          
          const [knowledgeBase, setKnowledgeBase] = useState({
            prohibitedWords: { docs: [], allWords: [] },
            filingData: { docs: [], allWords: [] },
            synonyms: { docs: [], allWords: [] }
          });

          useEffect(() => {
            const stored = localStorage.getItem('knowledgeBase');
            if (stored) {
              try {
                const parsed = JSON.parse(stored);
                if (Array.isArray(parsed.prohibitedWords)) {
                  setKnowledgeBase({
                    prohibitedWords: { docs: [], allWords: parsed.prohibitedWords || [] },
                    filingData: { docs: [], allWords: parsed.filingData || [] },
                    synonyms: { docs: [], allWords: parsed.synonyms || [] }
                  });
                } else {
                  setKnowledgeBase(parsed);
                }
              } catch (e) {}
            }
          }, []);

          const saveKnowledgeBase = (kb) => {
            setKnowledgeBase(kb);
            localStorage.setItem('knowledgeBase', JSON.stringify(kb));
          };

          const handleImageUpload = async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            const newImages = [];
            for (const file of files) {
              try {
                // å‹ç¼©å›¾ç‰‡ä»¥æé«˜APIå“åº”é€Ÿåº¦
                const compressedData = await compressImage(file);
                newImages.push({ 
                  id: Date.now() + Math.random(), 
                  name: file.name, 
                  data: compressedData 
                });
              } catch (error) {
                console.error('å›¾ç‰‡å¤„ç†å¤±è´¥:', error);
                alert(`å›¾ç‰‡ ${file.name} å¤„ç†å¤±è´¥`);
              }
            }
            setUploadedImages(prev => [...prev, ...newImages]);
          };
          
          // å‹ç¼©å›¾ç‰‡å‡½æ•°
          const compressImage = (file) => {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                  const canvas = document.createElement('canvas');
                  let width = img.width;
                  let height = img.height;
                  
                  // é™åˆ¶æœ€å¤§å°ºå¯¸ä¸º1920px
                  const maxSize = 1920;
                  if (width > maxSize || height > maxSize) {
                    if (width > height) {
                      height = (height / width) * maxSize;
                      width = maxSize;
                    } else {
                      width = (width / height) * maxSize;
                      height = maxSize;
                    }
                  }
                  
                  canvas.width = width;
                  canvas.height = height;
                  const ctx = canvas.getContext('2d');
                  ctx.drawImage(img, 0, 0, width, height);
                  
                  // å‹ç¼©ä¸ºJPEGï¼Œè´¨é‡0.8
                  resolve(canvas.toDataURL('image/jpeg', 0.8));
                };
                img.onerror = reject;
                img.src = event.target.result;
              };
              reader.onerror = reject;
              reader.readAsDataURL(file);
            });
          };

          const handleTextFileUpload = async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            for (const file of files) {
              try {
                // æ˜¾ç¤ºæ­£åœ¨ä¸Šä¼ çš„æ–‡ä»¶
                setUploadingFile(file.name);
                setUploadProgress('æ­£åœ¨è¯»å–æ–‡ä»¶...');
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°
                const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                if (file.size > 50 * 1024 * 1024) {
                  setUploadingFile(null);
                  setUploadProgress('');
                  if (!confirm(`æ–‡ä»¶ ${file.name} å¤§å°ä¸º ${fileSizeMB}MBï¼Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´å¤„ç†ã€‚\nå¦‚æœæ–‡ä»¶ä¸­æœ‰åµŒå…¥å›¾ç‰‡ï¼Œè¿˜éœ€è¦é¢å¤–çš„OCRè¯†åˆ«æ—¶é—´ã€‚\næ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                    continue;
                  }
                  setUploadingFile(file.name);
                }
                
                // æ˜¾ç¤ºå¤„ç†æç¤º
                const fileName = file.name;
                const fileExt = fileName.split('.').pop().toLowerCase();
                
                let extractedText = '';
                
                // æ ¹æ®æ–‡ä»¶ç±»å‹å¤„ç†
                if (fileExt === 'xlsx' || fileExt === 'xls') {
                  setUploadProgress(`è§£æExcelæ–‡ä»¶ (${fileSizeMB}MB)...`);
                  // Excelæ–‡ä»¶ï¼šä½¿ç”¨SheetJSè½¬æ¢ + æå–å›¾ç‰‡OCR
                  extractedText = await convertExcelToText(file, (progress) => {
                    setUploadProgress(progress);
                  });
                } else if (fileExt === 'csv') {
                  setUploadProgress('è¯»å–CSVæ–‡ä»¶...');
                  // CSVæ–‡ä»¶ï¼šç›´æ¥è¯»å–
                  extractedText = await file.text();
                } else {
                  setUploadProgress('è¯»å–æ–‡æœ¬æ–‡ä»¶...');
                  // å…¶ä»–æ–‡æœ¬æ–‡ä»¶ï¼šç›´æ¥è¯»å–
                  extractedText = await file.text();
                }
                
                setUploadProgress('å¤„ç†å®Œæˆï¼Œæ·»åŠ åˆ°åˆ—è¡¨...');
                
                // æ·»åŠ åˆ°æ–‡ä»¶åˆ—è¡¨
                setUploadedTextFiles(prev => [...prev, {
                  id: Date.now() + Math.random(),
                  name: fileName,
                  type: fileExt,
                  uploadTime: new Date().toLocaleString('zh-CN'),
                  wordCount: extractedText.split(/[\n,ï¼Œã€\s]+/).filter(w => w.trim()).length
                }]);
                
                // æ·»åŠ åˆ°æ–‡æœ¬è¾“å…¥æ¡†
                setTextInput(prev => prev + '\n\nã€' + fileName + 'ã€‘\n' + extractedText);
                
                // æ¸…é™¤è¿›åº¦æç¤º
                setUploadingFile(null);
                setUploadProgress('');
                
              } catch (error) {
                console.error(`å¤„ç†æ–‡ä»¶ ${file.name} å¤±è´¥:`, error);
                setUploadingFile(null);
                setUploadProgress('');
                alert(`æ–‡ä»¶ ${file.name} å¤„ç†å¤±è´¥: ${error.message}`);
              }
            }
          };
          
          // Excelè½¬æ–‡æœ¬å‡½æ•°ï¼ˆåŒ…å«å›¾ç‰‡OCRï¼‰
          const convertExcelToText = async (file, progressCallback) => {
            return new Promise(async (resolve, reject) => {
              const reader = new FileReader();
              
              reader.onload = async (e) => {
                try {
                  if (progressCallback) progressCallback('è§£æExcelç»“æ„...');
                  
                  const data = new Uint8Array(e.target.result);
                  const workbook = XLSX.read(data, { type: 'array', cellStyles: true });
                  
                  let allText = '';
                  let embeddedImages = [];
                  
                  if (progressCallback) progressCallback('æå–å·¥ä½œè¡¨æ–‡å­—...');
                  
                  // éå†æ‰€æœ‰å·¥ä½œè¡¨æå–æ–‡å­—
                  workbook.SheetNames.forEach((sheetName) => {
                    const worksheet = workbook.Sheets[sheetName];
                    const csv = XLSX.utils.sheet_to_csv(worksheet);
                    allText += `\n=== ${sheetName} ===\n${csv}\n`;
                  });
                  
                  // å°è¯•æå–åµŒå…¥çš„å›¾ç‰‡ï¼ˆä»åŸå§‹æ–‡ä»¶ï¼‰
                  try {
                    if (progressCallback) progressCallback('æ£€æµ‹åµŒå…¥å›¾ç‰‡...');
                    embeddedImages = await extractImagesFromExcel(file);
                    
                    if (embeddedImages.length > 0) {
                      const imgCount = embeddedImages.length;
                      allText += `\n\n=== æ£€æµ‹åˆ° ${imgCount} å¼ åµŒå…¥å›¾ç‰‡ï¼Œæ­£åœ¨è¯†åˆ«æ–‡å­—... ===\n`;
                      console.log(`å¼€å§‹OCRè¯†åˆ« ${imgCount} å¼ å›¾ç‰‡`);
                      
                      // OCRè¯†åˆ«æ¯å¼ å›¾ç‰‡
                      for (let i = 0; i < embeddedImages.length; i++) {
                        try {
                          if (progressCallback) progressCallback(`OCRè¯†åˆ«å›¾ç‰‡ ${i + 1}/${imgCount}...`);
                          
                          console.log(`æ­£åœ¨è¯†åˆ«å›¾ç‰‡ ${i + 1}/${imgCount}...`);
                          allText += `\nã€å›¾ç‰‡ ${i + 1}/${imgCount} - OCRè¯†åˆ«ä¸­...ã€‘\n`;
                          
                          const ocrText = await ocrImageData(embeddedImages[i]);
                          allText += ocrText + '\n';
                          
                          console.log(`å›¾ç‰‡ ${i + 1} è¯†åˆ«æˆåŠŸ`);
                        } catch (ocrError) {
                          console.error(`å›¾ç‰‡ ${i + 1} OCRå¤±è´¥:`, ocrError);
                          allText += `[å›¾ç‰‡ ${i + 1} è¯†åˆ«å¤±è´¥: ${ocrError.message}]\n`;
                        }
                      }
                      
                      console.log(`OCRè¯†åˆ«å®Œæˆ: æ€»å…± ${imgCount} å¼ å›¾ç‰‡`);
                    } else {
                      console.log('æœªæ£€æµ‹åˆ°åµŒå…¥å›¾ç‰‡');
                    }
                  } catch (imgError) {
                    console.warn('æå–åµŒå…¥å›¾ç‰‡å¤±è´¥:', imgError);
                    allText += '\n[æ³¨æ„ï¼šæ— æ³•æå–åµŒå…¥å›¾ç‰‡ï¼Œå¦‚æœ‰å›¾ç‰‡è¯·å•ç‹¬ä¸Šä¼ ]\n';
                  }
                  
                  resolve(allText);
                } catch (error) {
                  reject(new Error('Excelæ–‡ä»¶è§£æå¤±è´¥: ' + error.message));
                }
              };
              
              reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
              reader.readAsArrayBuffer(file);
            });
          };
          
          // ä»Excelæå–åµŒå…¥å›¾ç‰‡
          const extractImagesFromExcel = async (file) => {
            return new Promise((resolve, reject) => {
              const JSZip = window.JSZip || null;
              if (!JSZip) {
                // å¦‚æœæ²¡æœ‰JSZipåº“ï¼Œè¿”å›ç©ºæ•°ç»„
                resolve([]);
                return;
              }
              
              const reader = new FileReader();
              reader.onload = async (e) => {
                try {
                  const zip = await JSZip.loadAsync(e.target.result);
                  const images = [];
                  
                  // Excelå›¾ç‰‡é€šå¸¸åœ¨ xl/media/ æ–‡ä»¶å¤¹
                  const mediaFolder = zip.folder('xl/media');
                  if (mediaFolder) {
                    const files = Object.keys(zip.files).filter(name => name.startsWith('xl/media/'));
                    
                    for (const fileName of files) {
                      const file = zip.files[fileName];
                      if (!file.dir) {
                        const blob = await file.async('blob');
                        const dataUrl = await blobToDataURL(blob);
                        images.push(dataUrl);
                      }
                    }
                  }
                  
                  resolve(images);
                } catch (error) {
                  console.error('æå–å›¾ç‰‡å¤±è´¥:', error);
                  resolve([]);
                }
              };
              reader.onerror = () => resolve([]);
              reader.readAsArrayBuffer(file);
            });
          };
          
          // Blobè½¬DataURL
          const blobToDataURL = (blob) => {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(blob);
            });
          };
          
          // OCRè¯†åˆ«å›¾ç‰‡æ•°æ®
          const ocrImageData = async (imageDataUrl) => {
            // ä½¿ç”¨åƒé—®APIè¿›è¡ŒOCR
            try {
              const response = await fetch(PROXY_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  image: imageDataUrl,
                  text: 'è¯·è¯†åˆ«å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—å†…å®¹ï¼Œç›´æ¥è¾“å‡ºè¯†åˆ«åˆ°çš„æ–‡å­—ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚'
                })
              });
              
              if (!response.ok) {
                const errorText = await response.text();
                console.error('OCR APIé”™è¯¯:', errorText);
                throw new Error(`OCRè¯·æ±‚å¤±è´¥ (${response.status})`);
              }
              
              const data = await response.json();
              console.log('OCR APIè¿”å›:', data);
              
              // è¯¦ç»†æ£€æŸ¥è¿”å›æ•°æ®
              if (!data.output) {
                throw new Error('APIè¿”å›ç¼ºå°‘outputå­—æ®µ');
              }
              
              if (!data.output.choices || data.output.choices.length === 0) {
                throw new Error('APIæœªè¿”å›è¯†åˆ«ç»“æœ');
              }
              
              const choice = data.output.choices[0];
              if (!choice.message || !choice.message.content) {
                throw new Error('APIè¿”å›æ ¼å¼å¼‚å¸¸');
              }
              
              // contentå¯èƒ½æ˜¯æ•°ç»„æˆ–å­—ç¬¦ä¸²
              const content = choice.message.content;
              if (Array.isArray(content)) {
                if (content.length === 0 || !content[0].text) {
                  throw new Error('è¯†åˆ«ç»“æœä¸ºç©º');
                }
                return content[0].text;
              } else if (typeof content === 'string') {
                return content;
              } else {
                throw new Error('æ— æ³•è§£æè¯†åˆ«ç»“æœ');
              }
              
            } catch (error) {
              console.error('OCRå®Œæ•´é”™è¯¯:', error);
              throw new Error('OCRè¯†åˆ«å¤±è´¥: ' + error.message);
            }
          };

          const toggleImageSelection = (id) => {
            setSelectedImages(prev =>
              prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
            );
          };

          const deleteSelectedImages = () => {
            if (selectedImages.length === 0) return alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
            if (!confirm(`ç¡®å®šåˆ é™¤ ${selectedImages.length} å¼ å›¾ç‰‡ï¼Ÿ`)) return;
            setUploadedImages(prev => prev.filter(img => !selectedImages.includes(img.id)));
            setSelectedImages([]);
          };

          const deleteTextFile = (id) => {
            if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
            setUploadedTextFiles(prev => prev.filter(f => f.id !== id));
          };

          // OCR æå–å›¾ç‰‡æ–‡å­—ï¼ˆé€šè¿‡ä»£ç†è°ƒç”¨åƒé—®APIï¼‰
          const extractTextFromImages = async () => {
            if (selectedImages.length === 0) return alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
            
            setIsExtractingText(true);
            let successCount = 0;
            let failCount = 0;
            
            try {
              const selectedImgs = uploadedImages.filter(img => selectedImages.includes(img.id));
              
              for (const img of selectedImgs) {
                try {
                  // é€šè¿‡ä»£ç†è°ƒç”¨åƒé—®APIï¼ˆå¢åŠ è¶…æ—¶å¤„ç†ï¼‰
                  const controller = new AbortController();
                  const timeoutId = setTimeout(() => controller.abort(), 60000); // 60ç§’è¶…æ—¶
                  
                  const response = await fetch(PROXY_API_URL, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                      image: img.data,
                      text: 'è¯·è¯†åˆ«å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—å†…å®¹ï¼Œç›´æ¥è¾“å‡ºè¯†åˆ«åˆ°çš„æ–‡å­—ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚'
                    }),
                    signal: controller.signal
                  });
                  
                  clearTimeout(timeoutId);

                  if (!response.ok) {
                    const errorText = await response.text();
                    console.error('ä»£ç†APIé”™è¯¯:', errorText);
                    
                    if (response.status === 504) {
                      throw new Error('APIå“åº”è¶…æ—¶ï¼Œå›¾ç‰‡å¯èƒ½å¤ªå¤§æˆ–ç½‘ç»œè¾ƒæ…¢');
                    }
                    throw new Error(`APIè¯·æ±‚å¤±è´¥ (${response.status})`);
                  }

                  const data = await response.json();
                  console.log('APIè¿”å›:', data);
                  
                  if (!data.output || !data.output.choices || data.output.choices.length === 0) {
                    throw new Error('APIæ²¡æœ‰è¿”å›è¯†åˆ«ç»“æœ');
                  }
                  
                  const extractedText = data.output.choices[0].message.content[0].text;
                  
                  if (!extractedText || extractedText.trim() === '') {
                    throw new Error('æœªè¯†åˆ«åˆ°æ–‡å­—å†…å®¹');
                  }
                  
                  setTextInput(prev => prev + '\n\nã€' + img.name + ' - OCRè¯†åˆ«ã€‘\n' + extractedText);
                  successCount++;
                  
                } catch (imgError) {
                  console.error(`å¤„ç†å›¾ç‰‡ ${img.name} å¤±è´¥:`, imgError);
                  
                  if (imgError.name === 'AbortError') {
                    console.error('è¯·æ±‚è¶…æ—¶');
                  }
                  
                  failCount++;
                }
              }
              
              if (successCount > 0) {
                alert(`âœ“ æˆåŠŸæå– ${successCount} å¼ å›¾ç‰‡çš„æ–‡å­—${failCount > 0 ? `\nâœ— ${failCount} å¼ å¤±è´¥` : ''}`);
              } else {
                alert(`âœ— æå–å¤±è´¥\n\nå¯èƒ½åŸå› ï¼š\n1. ä»£ç†æœªéƒ¨ç½²æˆ–é…ç½®é”™è¯¯\n2. APIå¯†é’¥æ— æ•ˆ\n3. å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ\n\nè¯·æŸ¥çœ‹README.mdäº†è§£éƒ¨ç½²æ­¥éª¤`);
              }
            } catch (error) {
              console.error('OCRæ•´ä½“é”™è¯¯:', error);
              alert('æå–å¤±è´¥ï¼š' + error.message);
            }
            setIsExtractingText(false);
          };

          const handleKnowledgeUpload = async (files, type) => {
            if (!files || files.length === 0) return;

            const newDocs = [];
            let totalWords = 0;

            for (const file of files) {
              const text = await file.text();
              const words = text.split(/[,ï¼Œã€\n\s]+/).filter(w => w.trim().length > 0 && w.length < 50);
              
              newDocs.push({
                id: Date.now() + Math.random(),
                name: file.name,
                wordCount: words.length,
                uploadTime: new Date().toLocaleString('zh-CN'),
                words: words
              });
              totalWords += words.length;
            }

            const newKb = { ...knowledgeBase };
            newKb[type].docs = [...newKb[type].docs, ...newDocs];
            
            const allWordsSet = new Set();
            newKb[type].docs.forEach(doc => {
              doc.words.forEach(word => allWordsSet.add(word));
            });
            newKb[type].allWords = Array.from(allWordsSet);
            
            saveKnowledgeBase(newKb);
            alert(`å·²æ·»åŠ  ${newDocs.length} ä¸ªæ–‡æ¡£ï¼Œå…± ${totalWords} ä¸ªè¯æ¡`);
          };

          const deleteKnowledgeDoc = (type, docId) => {
            if (!confirm('ç¡®å®šåˆ é™¤æ­¤æ–‡æ¡£ï¼Ÿ')) return;
            
            const newKb = { ...knowledgeBase };
            newKb[type].docs = newKb[type].docs.filter(doc => doc.id !== docId);
            
            const allWordsSet = new Set();
            newKb[type].docs.forEach(doc => {
              doc.words.forEach(word => allWordsSet.add(word));
            });
            newKb[type].allWords = Array.from(allWordsSet);
            
            saveKnowledgeBase(newKb);
          };

          const clearKnowledge = (type) => {
            if (!confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ–‡æ¡£ï¼Ÿ')) return;
            const newKb = { ...knowledgeBase };
            newKb[type] = { docs: [], allWords: [] };
            saveKnowledgeBase(newKb);
          };

          const scanWithGemini = async () => {
            if (!textInput.trim()) return alert('è¯·å…ˆè¾“å…¥æ–‡æ¡ˆ');
            if (knowledgeBase.prohibitedWords.allWords.length === 0) {
              return alert('è¯·å…ˆä¸Šä¼ è¿ç¦è¯æ¸…å•');
            }

            setLoading(true);
            try {
              const prompt = `ä½ æ˜¯ç¾å¦†å¹¿å‘Šåˆè§„ä¸“å®¶ã€‚ä¸¥æ ¼æ£€æŸ¥ä»¥ä¸‹æ–‡æ¡ˆä¸­çš„è¿è§„å†…å®¹ï¼š

ã€è¿ç¦è¯åº“ã€‘${knowledgeBase.prohibitedWords.allWords.slice(0, 300).join('ã€')}
ã€å·²å¤‡æ¡ˆåŠŸæ•ˆã€‘${knowledgeBase.filingData.allWords.slice(0, 200).join('ã€')}
ã€åŒä¹‰è¯è¡¨ã€‘${knowledgeBase.synonyms.allWords.slice(0, 100).join('ã€')}

ã€å¾…æ£€æŸ¥æ–‡æ¡ˆã€‘
${textInput}

è¯·ä»¥JSONæ ¼å¼è¿”å›æ£€æŸ¥ç»“æœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{"issues":[{"word":"è¿ç¦è¯","category":"è¿ç¦ç±»å‹","suggestion":"ä¿®æ”¹å»ºè®®"}],"warnings":[{"word":"åŠŸæ•ˆè¯","suggestion":"å¤‡æ¡ˆå»ºè®®"}]}

æ³¨æ„ï¼šåªè¿”å›JSONï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–æ–‡å­—ã€‚`;

              // ä½¿ç”¨åƒé—®APIè¿›è¡Œæ‰«æï¼ˆé€šè¿‡Vercelä»£ç†ï¼‰
              const response = await fetch(PROXY_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  image: '', // æ–‡æœ¬æ‰«æä¸éœ€è¦å›¾ç‰‡
                  text: prompt
                })
              });

              if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥ (${response.status})`);
              }

              const data = await response.json();
              console.log('åƒé—®APIè¿”å›:', data);
              
              // è§£æåƒé—®APIè¿”å›çš„ç»“æœ
              if (!data.output || !data.output.choices || data.output.choices.length === 0) {
                throw new Error('APIæ²¡æœ‰è¿”å›æœ‰æ•ˆç»“æœ');
              }
              
              const text = data.output.choices[0].message.content[0].text;
              console.log('AIè¿”å›æ–‡æœ¬:', text);
              
              // æå–JSON
              const jsonMatch = text.match(/\{[\s\S]*\}/);
              if (!jsonMatch) {
                throw new Error('AIè¿”å›æ ¼å¼ä¸æ­£ç¡®ï¼Œæ— æ³•è§£æJSON');
              }
              
              const result = JSON.parse(jsonMatch[0]);

              setScanResults({
                issues: result.issues || [],
                warnings: result.warnings || [],
                scanTime: new Date().toLocaleString('zh-CN'),
                stats: {
                  prohibitedWordsUsed: knowledgeBase.prohibitedWords.allWords.length,
                  filingDataUsed: knowledgeBase.filingData.allWords.length,
                  synonymsUsed: knowledgeBase.synonyms.allWords.length
                }
              });
            } catch (error) {
              console.error('æ‰«æé”™è¯¯è¯¦æƒ…:', error);
              alert('æ‰«æå¤±è´¥ï¼š' + error.message + '\n\nè¯·æ£€æŸ¥ï¼š\n1. Gemini APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ\n2. æ˜¯å¦æœ‰ç½‘ç»œè¿æ¥\n3. æµè§ˆå™¨æ§åˆ¶å°(F12)æŸ¥çœ‹è¯¦ç»†é”™è¯¯');
            }
            setLoading(false);
          };

          return (
            <>
              <div className="header">
                <div className="logo">
                  <div className="logo-icon">
                    <div className="scale-left"></div>
                    <div className="scale-right"></div>
                  </div>
                  <span>COMPLIANCE</span>
                </div>
                <div className="nav-menu">
                  <a href="#" className="nav-link">é¦–é¡µ</a>
                  <a href="#" className="nav-link">å…³äº</a>
                  <a href="#" className="nav-link">è”ç³»</a>
                </div>
              </div>

              <div className="container">
                <div className="hero">
                  <h1 className="hero-title">ç¾å¦†å¹¿å‘Šåˆè§„ AI åŠ©ç†</h1>
                  <p className="hero-subtitle">
                    æ™ºèƒ½æ£€æµ‹å¹¿å‘Šæ–‡æ¡ˆåˆè§„æ€§ï¼Œæä¾›ä¸“ä¸šçš„æ³•è§„å»ºè®®ã€‚åŸºäºæœ€æ–°å¹¿å‘Šæ³•è§„å®šï¼Œå¸®åŠ©æ‚¨çš„å“ç‰Œé¿å…æ³•å¾‹é£é™©ã€‚
                  </p>
                </div>

                <div className="tabs">
                  <button 
                    className={`tab ${activeTab === 'scanner' ? 'active' : ''}`}
                    onClick={() => setActiveTab('scanner')}
                  >
                    æ™ºèƒ½æ‰«æ
                  </button>
                  <button 
                    className={`tab ${activeTab === 'knowledge' ? 'active' : ''}`}
                    onClick={() => setActiveTab('knowledge')}
                  >
                    çŸ¥è¯†åº“ç®¡ç†
                  </button>
                </div>

                {activeTab === 'scanner' && (
                  <div>
                    <div className="grid grid-2 mb-4">
                      <div className="upload-area" onClick={() => !uploadingFile && document.getElementById('imageUpload').click()}>
                        <div className="upload-icon">ğŸ“·</div>
                        <div className="upload-title">ä¸Šä¼ å›¾ç‰‡ç´ æ</div>
                        <div className="upload-subtitle">æ”¯æŒ JPGã€PNG æ ¼å¼</div>
                        <input id="imageUpload" type="file" multiple accept="image/*" onChange={handleImageUpload} disabled={uploadingFile} />
                      </div>

                      <div className="upload-area" onClick={() => !uploadingFile && document.getElementById('textFileUpload').click()}>
                        <div className="upload-icon">ğŸ“„</div>
                        <div className="upload-title">ä¸Šä¼ æ–‡å­—æ–‡æ¡£</div>
                        <div className="upload-subtitle">æ”¯æŒ TXTã€Wordã€Excelã€Markdownã€XMindã€PDF</div>
                        <input id="textFileUpload" type="file" multiple accept=".txt,.doc,.docx,.md,.markdown,.xmind,.pdf,.xlsx,.xls" onChange={handleTextFileUpload} disabled={uploadingFile} />
                      </div>
                    </div>

                    {uploadingFile && (
                      <div className="alert" style={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        border: 'none',
                        color: '#fff',
                        padding: '16px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '16px',
                        boxShadow: '0 4px 12px rgba(102, 126, 234, 0.4)'
                      }}>
                        <div className="spin" style={{fontSize: '24px'}}>âš™ï¸</div>
                        <div style={{flex: 1}}>
                          <div style={{fontWeight: '600', marginBottom: '4px'}}>{uploadingFile}</div>
                          <div style={{fontSize: '14px', opacity: 0.9}}>{uploadProgress}</div>
                        </div>
                      </div>
                    )}

                    {uploadedImages.length > 0 && (
                      <div className="section">
                        <div className="flex items-center justify-between mb-4">
                          <h2 className="section-title">å·²ä¸Šä¼ å›¾ç‰‡</h2>
                          <div style={{display: 'flex', gap: '12px'}}>
                            <button 
                              className="btn btn-primary" 
                              onClick={extractTextFromImages}
                              disabled={isExtractingText || selectedImages.length === 0}
                              style={{width: 'auto', padding: '10px 20px', fontSize: '13px'}}
                            >
                              {isExtractingText ? 'âš™ï¸ è¯†åˆ«ä¸­...' : 'ğŸ“ æå–æ–‡å­—'}
                            </button>
                            <button className="btn btn-secondary" onClick={deleteSelectedImages}>
                              åˆ é™¤é€‰ä¸­ ({selectedImages.length})
                            </button>
                          </div>
                        </div>
                        <div className="image-grid">
                          {uploadedImages.map(img => (
                            <div 
                              key={img.id}
                              className={`image-item ${selectedImages.includes(img.id) ? 'selected' : ''}`}
                              onClick={() => toggleImageSelection(img.id)}
                            >
                              <img src={img.data} alt={img.name} />
                              <div className="image-name">{img.name}</div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {uploadedTextFiles.length > 0 && (
                      <div className="section">
                        <h2 className="section-title">å·²ä¸Šä¼ æ–‡æ¡£</h2>
                        {uploadingFile && (
                          <div className="alert" style={{
                            background: '#fff3cd',
                            border: '1px solid #ffc107',
                            color: '#856404',
                            padding: '12px 16px',
                            borderRadius: '8px',
                            marginBottom: '16px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                          }}>
                            <div className="spin" style={{fontSize: '20px'}}>âš™ï¸</div>
                            <div>
                              <strong>{uploadingFile}</strong>
                              <div style={{fontSize: '13px', marginTop: '4px'}}>{uploadProgress}</div>
                            </div>
                          </div>
                        )}
                        <div className="list">
                          {uploadedTextFiles.map(file => (
                            <div key={file.id} className="list-item">
                              <div className="list-item-content">
                                <div className="list-item-icon">
                                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M7 4.75H17C18.1 4.75 19 5.65 19 6.75V17.25C19 18.35 18.1 19.25 17 19.25H7C5.9 19.25 5 18.35 5 17.25V6.75C5 5.65 5.9 4.75 7 4.75Z" stroke="currentColor" strokeWidth="1.5"/>
                                    <path d="M10 4.75V19.25" stroke="currentColor" strokeWidth="1.5"/>
                                  </svg>
                                </div>
                                <div>
                                  <div className="list-item-title">{file.name}</div>
                                  <div className="list-item-meta">{file.type.toUpperCase()} Â· {file.uploadTime}</div>
                                </div>
                              </div>
                              <button className="btn btn-secondary" onClick={() => deleteTextFile(file.id)}>åˆ é™¤</button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    <div className="section">
                      <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                        <h2 className="section-title" style={{marginBottom: '0'}}>å¹¿å‘Šæ–‡æ¡ˆ</h2>
                        {textInput && (
                          <button 
                            className="btn btn-secondary"
                            onClick={() => {
                              if (confirm('ç¡®å®šæ¸…é™¤æ–‡æ¡ˆå†…å®¹ï¼Ÿ')) {
                                setTextInput('');
                              }
                            }}
                            style={{
                              padding: '6px 12px',
                              fontSize: '13px',
                              background: '#fff',
                              color: '#666',
                              border: '1px solid #ddd',
                              borderRadius: '6px',
                              cursor: 'pointer',
                              transition: 'all 0.2s'
                            }}
                            onMouseEnter={(e) => {
                              e.target.style.background = '#f5f5f5';
                              e.target.style.borderColor = '#999';
                            }}
                            onMouseLeave={(e) => {
                              e.target.style.background = '#fff';
                              e.target.style.borderColor = '#ddd';
                            }}
                          >
                            ğŸ—‘ï¸ æ¸…é™¤æ–‡æ¡ˆ
                          </button>
                        )}
                      </div>
                      <textarea 
                        className="textarea"
                        value={textInput}
                        onChange={(e) => setTextInput(e.target.value)}
                        placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´å¹¿å‘Šæ–‡æ¡ˆ..."
                      />
                    </div>

                    <button className="btn btn-primary" onClick={scanWithGemini} disabled={loading}>
                      {loading ? <><span className="spin">âš™ï¸</span> æ­£åœ¨æ‰«æ...</> : 'å¼€å§‹æ‰«æ'}
                    </button>

                    {scanResults && (
                      <>
                        <div className="divider"></div>

                        <div className="section" style={{position: 'relative'}}>
                          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <div>
                              <h2 className="section-title">æ‰«æç»“æœ</h2>
                              <p className="section-subtitle">æ‰«ææ—¶é—´ï¼š{scanResults.scanTime}</p>
                            </div>
                            <button 
                              className="btn btn-secondary"
                              onClick={() => {
                                if (confirm('ç¡®å®šæ¸…é™¤æ‰«æç»“æœï¼Ÿ')) {
                                  setScanResults(null);
                                }
                              }}
                              style={{
                                padding: '10px 20px',
                                fontSize: '14px',
                                background: '#fff',
                                color: '#666',
                                border: '1px solid #ddd',
                                borderRadius: '8px',
                                cursor: 'pointer',
                                transition: 'all 0.2s'
                              }}
                              onMouseEnter={(e) => {
                                e.target.style.background = '#f5f5f5';
                                e.target.style.borderColor = '#999';
                              }}
                              onMouseLeave={(e) => {
                                e.target.style.background = '#fff';
                                e.target.style.borderColor = '#ddd';
                              }}
                            >
                              ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                            </button>
                          </div>

                          {scanResults.stats && (
                            <div className="alert">
                              å·²ä½¿ç”¨çŸ¥è¯†åº“ï¼šè¿ç¦è¯ {scanResults.stats.prohibitedWordsUsed} æ¡ Â· åŠŸæ•ˆè¯ {scanResults.stats.filingDataUsed} æ¡ Â· åŒä¹‰è¯ {scanResults.stats.synonymsUsed} æ¡
                            </div>
                          )}

                          <div className="stats">
                            <div className="stat">
                              <div className="stat-value" style={{color: '#ff3b30'}}>
                                {scanResults.issues.length}
                              </div>
                              <div className="stat-label">è¿ç¦é—®é¢˜</div>
                            </div>
                            <div className="stat">
                              <div className="stat-value" style={{color: '#ff9500'}}>
                                {scanResults.warnings.length}
                              </div>
                              <div className="stat-label">å¤‡æ¡ˆè­¦å‘Š</div>
                            </div>
                            <div className="stat">
                              <div className="stat-value" style={{color: '#34c759'}}>
                                {scanResults.issues.length === 0 && scanResults.warnings.length === 0 ? 'âœ“' : '!'}
                              </div>
                              <div className="stat-label">åˆè§„çŠ¶æ€</div>
                            </div>
                          </div>

                          {scanResults.issues.length > 0 && (
                            <div className="mb-4">
                              {scanResults.issues.map((issue, i) => (
                                <div key={i} className="issue error">
                                  <div className="issue-header">
                                    <span className="issue-badge">{issue.category}</span>
                                    <span className="issue-word">"{issue.word}"</span>
                                  </div>
                                  <div className="issue-suggestion">{issue.suggestion}</div>
                                </div>
                              ))}
                            </div>
                          )}

                          {scanResults.warnings.length > 0 && (
                            <div className="mb-4">
                              {scanResults.warnings.map((w, i) => (
                                <div key={i} className="issue warning">
                                  <div className="issue-header">
                                    <span className="issue-badge">åŠŸæ•ˆè¯</span>
                                    <span className="issue-word">"{w.word}"</span>
                                  </div>
                                  <div className="issue-suggestion">{w.suggestion}</div>
                                </div>
                              ))}
                            </div>
                          )}

                          {scanResults.issues.length === 0 && scanResults.warnings.length === 0 && (
                            <div className="success-state">
                              <div className="success-icon">âœ“</div>
                              <div className="success-title">æœªæ£€æµ‹åˆ°åˆè§„é—®é¢˜</div>
                              <div className="success-text">è¯¥æ–‡æ¡ˆç¬¦åˆå¹¿å‘Šæ³•è§„è¦æ±‚</div>
                            </div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                )}

                {activeTab === 'knowledge' && (
                  <div>
                    <div className="section">
                      <h2 className="section-title">çŸ¥è¯†åº“ç®¡ç†</h2>
                      <p className="section-subtitle">ä¸Šä¼ å’Œç®¡ç†æ‚¨çš„æ³•è§„çŸ¥è¯†åº“æ–‡æ¡£</p>
                    </div>

                    <div className="grid grid-3">
                      <div className="card">
                        <div className="card-icon">ğŸš«</div>
                        <div className="card-title">è¿ç¦è¯æ¸…å•</div>
                        <div className="card-text" style={{marginBottom: '20px'}}>
                          {knowledgeBase.prohibitedWords.docs.length} ä¸ªæ–‡æ¡£ Â· {knowledgeBase.prohibitedWords.allWords.length} ä¸ªè¯æ¡
                        </div>
                        <div 
                          className="upload-area" 
                          style={{padding: '20px'}}
                          onClick={() => document.getElementById('prohibitedUpload').click()}
                        >
                          <div className="upload-subtitle">ç‚¹å‡»ä¸Šä¼ æ–‡æ¡£</div>
                          <input 
                            id="prohibitedUpload"
                            type="file"
                            multiple
                            accept=".txt,.csv,.xlsx,.xls,.docx,.doc,.md,.markdown"
                            onChange={(e) => handleKnowledgeUpload(Array.from(e.target.files), 'prohibitedWords')}
                          />
                        </div>
                        {knowledgeBase.prohibitedWords.docs.length > 0 && (
                          <div style={{marginTop: '20px'}}>
                            <div className="list">
                              {knowledgeBase.prohibitedWords.docs.map(doc => (
                                <div key={doc.id} className="list-item">
                                  <div className="list-item-content">
                                    <div className="list-item-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M7 4.75H17C18.1 4.75 19 5.65 19 6.75V17.25C19 18.35 18.1 19.25 17 19.25H7C5.9 19.25 5 18.35 5 17.25V6.75C5 5.65 5.9 4.75 7 4.75Z" stroke="currentColor" strokeWidth="1.5"/><path d="M10 4.75V19.25" stroke="currentColor" strokeWidth="1.5"/></svg></div>
                                    <div>
                                      <div className="list-item-title">{doc.name}</div>
                                      <div className="list-item-meta">{doc.wordCount} è¯æ¡</div>
                                    </div>
                                  </div>
                                  <button 
                                    className="btn btn-secondary"
                                    onClick={() => deleteKnowledgeDoc('prohibitedWords', doc.id)}
                                  >
                                    åˆ é™¤
                                  </button>
                                </div>
                              ))}
                            </div>
                            <button 
                              className="btn btn-secondary"
                              style={{width: '100%', marginTop: '12px'}}
                              onClick={() => clearKnowledge('prohibitedWords')}
                            >
                              æ¸…ç©ºæ‰€æœ‰
                            </button>
                          </div>
                        )}
                      </div>

                      <div className="card">
                        <div className="card-icon">âš ï¸</div>
                        <div className="card-title">åŠŸæ•ˆå¤‡æ¡ˆè¡¨</div>
                        <div className="card-text" style={{marginBottom: '20px'}}>
                          {knowledgeBase.filingData.docs.length} ä¸ªæ–‡æ¡£ Â· {knowledgeBase.filingData.allWords.length} ä¸ªè¯æ¡
                        </div>
                        <div 
                          className="upload-area" 
                          style={{padding: '20px'}}
                          onClick={() => document.getElementById('filingUpload').click()}
                        >
                          <div className="upload-subtitle">ç‚¹å‡»ä¸Šä¼ æ–‡æ¡£</div>
                          <input 
                            id="filingUpload"
                            type="file"
                            multiple
                            accept=".txt,.csv,.xlsx,.xls,.docx,.doc,.md,.markdown"
                            onChange={(e) => handleKnowledgeUpload(Array.from(e.target.files), 'filingData')}
                          />
                        </div>
                        {knowledgeBase.filingData.docs.length > 0 && (
                          <div style={{marginTop: '20px'}}>
                            <div className="list">
                              {knowledgeBase.filingData.docs.map(doc => (
                                <div key={doc.id} className="list-item">
                                  <div className="list-item-content">
                                    <div className="list-item-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M7 4.75H17C18.1 4.75 19 5.65 19 6.75V17.25C19 18.35 18.1 19.25 17 19.25H7C5.9 19.25 5 18.35 5 17.25V6.75C5 5.65 5.9 4.75 7 4.75Z" stroke="currentColor" strokeWidth="1.5"/><path d="M10 4.75V19.25" stroke="currentColor" strokeWidth="1.5"/></svg></div>
                                    <div>
                                      <div className="list-item-title">{doc.name}</div>
                                      <div className="list-item-meta">{doc.wordCount} è¯æ¡</div>
                                    </div>
                                  </div>
                                  <button 
                                    className="btn btn-secondary"
                                    onClick={() => deleteKnowledgeDoc('filingData', doc.id)}
                                  >
                                    åˆ é™¤
                                  </button>
                                </div>
                              ))}
                            </div>
                            <button 
                              className="btn btn-secondary"
                              style={{width: '100%', marginTop: '12px'}}
                              onClick={() => clearKnowledge('filingData')}
                            >
                              æ¸…ç©ºæ‰€æœ‰
                            </button>
                          </div>
                        )}
                      </div>

                      <div className="card">
                        <div className="card-icon">ğŸ”„</div>
                        <div className="card-title">åŒä¹‰è¯å¯¹ç…§è¡¨</div>
                        <div className="card-text" style={{marginBottom: '20px'}}>
                          {knowledgeBase.synonyms.docs.length} ä¸ªæ–‡æ¡£ Â· {knowledgeBase.synonyms.allWords.length} ä¸ªè¯æ¡
                        </div>
                        <div 
                          className="upload-area" 
                          style={{padding: '20px'}}
                          onClick={() => document.getElementById('synonymUpload').click()}
                        >
                          <div className="upload-subtitle">ç‚¹å‡»ä¸Šä¼ æ–‡æ¡£</div>
                          <input 
                            id="synonymUpload"
                            type="file"
                            multiple
                            accept=".txt,.csv,.xlsx,.xls,.docx,.doc,.md,.markdown"
                            onChange={(e) => handleKnowledgeUpload(Array.from(e.target.files), 'synonyms')}
                          />
                        </div>
                        {knowledgeBase.synonyms.docs.length > 0 && (
                          <div style={{marginTop: '20px'}}>
                            <div className="list">
                              {knowledgeBase.synonyms.docs.map(doc => (
                                <div key={doc.id} className="list-item">
                                  <div className="list-item-content">
                                    <div className="list-item-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M7 4.75H17C18.1 4.75 19 5.65 19 6.75V17.25C19 18.35 18.1 19.25 17 19.25H7C5.9 19.25 5 18.35 5 17.25V6.75C5 5.65 5.9 4.75 7 4.75Z" stroke="currentColor" strokeWidth="1.5"/><path d="M10 4.75V19.25" stroke="currentColor" strokeWidth="1.5"/></svg></div>
                                    <div>
                                      <div className="list-item-title">{doc.name}</div>
                                      <div className="list-item-meta">{doc.wordCount} è¯æ¡</div>
                                    </div>
                                  </div>
                                  <button 
                                    className="btn btn-secondary"
                                    onClick={() => deleteKnowledgeDoc('synonyms', doc.id)}
                                  >
                                    åˆ é™¤
                                  </button>
                                </div>
                              ))}
                            </div>
                            <button 
                              className="btn btn-secondary"
                              style={{width: '100%', marginTop: '12px'}}
                              onClick={() => clearKnowledge('synonyms')}
                            >
                              æ¸…ç©ºæ‰€æœ‰
                            </button>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
